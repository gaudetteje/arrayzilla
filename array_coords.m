% array coordinates as measured by sectioning with total station
%    x = [-0.260 0.044 0.347 0.757 1.367 -0.337 0.044 0.350 0.758 1.062 1.468 -0.335 -0.334 -0.334 -0.257  0.046  0.046  0.048  0.049  0.760  0.761  0.762  0.763  1.470  1.472  1.474  1.373  0.252  1.065 1.058   0.351  0.352  0.353  0.354  0.556  1.064  1.064  1.065];
%    y = [ 0.607 0.607 0.609 0.610 0.611  0.354 0.355 0.356 0.356 0.356 0.356 -0.026 -0.279 -0.534 -0.787 -0.027 -0.280 -0.535 -0.787 -0.026 -0.279 -0.535 -0.789 -0.026 -0.278 -0.533 -0.787 -0.787 -0.786 0.482   0.026 -0.279 -0.534 -0.788 -0.026 -0.026 -0.278 -0.533];
%    z = [ 1.462 1.473 1.489 1.513 1.546  1.444 1.459 1.474 1.494 1.509 1.531  1.417  1.398  1.381  1.367  1.431  1.415  1.399  1.379  1.469  1.451  1.433  1.414  1.504  1.487  1.470  1.446  1.387  1.426 1.515   1.447  1.430  1.412  1.394  1.459  1.483  1.464  1.445];

x = [-0.2570    0.0490    0.2520    0.3540    0.7630    1.0650    1.3730   -0.3340    0.0480    0.3530    0.7620    1.0650    1.4740   -0.3340    0.0460    0.3520    0.7610    1.0640    1.4720   -0.3350    0.0460    0.5560    0.7600    1.0640    1.4700   -0.3370    0.0440    0.3500    0.7580    1.0620    1.4680    1.0580   -0.2600    0.0440    0.3470    0.7570    1.3670];
y = [-0.7870   -0.7870   -0.7870   -0.7880   -0.7890   -0.7860   -0.7870   -0.5340   -0.5350   -0.5340   -0.5350   -0.5330   -0.5330   -0.2790   -0.2800   -0.2790   -0.2790   -0.2780   -0.2780   -0.0260   -0.0270   -0.0260   -0.0260   -0.0260   -0.0260    0.3540    0.3550    0.3560    0.3560    0.3560    0.3560    0.4820    0.6070    0.6070    0.6090    0.6100    0.6110];
z = [ 1.3670    1.3790    1.3870    1.3940    1.4140    1.4260    1.4460    1.3810    1.3990    1.4120    1.4330    1.4450    1.4700    1.3980    1.4150    1.4300    1.4510    1.4640    1.4870    1.4170    1.4310    1.4590    1.4690    1.4830    1.5040    1.4440    1.4590    1.4740    1.4940    1.5090    1.5310    1.5150    1.4620    1.4730    1.4890    1.5130    1.5460];


% move origin to known mic position
x = x-x(1);
y = y-y(1);
z = z-z(1);

% rotate coords by correct angles
theta = -atan(.095/1.394);
phi = atan(.07882/1.63);
zeta = 0;
Rx = [1 0 0; 0 cos(theta) -sin(theta); 0 sin(theta) cos(theta)];
Ry = [cos(phi) 0 sin(phi); 0 1 0; -sin(phi) 0 cos(phi)];
Rz = [cos(zeta) -sin(zeta) 0; sin(zeta) cos(zeta) 0; 0 0 1];
R3 = Rx*Ry*Rz;

for n = 1:length(x)
    micpos(:,n) = R3 * [x(n); y(n); z(n)];
end

% translate origin to bottom left corner while facing array
micpos(1,:) = micpos(1,:) + 3.5*.0254;
micpos(2,:) = micpos(2,:) + 0.5*.0254;

% save to MAT file
save('arrayzilla_coords.mat','micpos')  

% show array results
%close all
plot3(micpos(1,:), micpos(2,:), micpos(3,:), '.b')

xlabel('x')
ylabel('y')
zlabel('z')
grid on

axis equal